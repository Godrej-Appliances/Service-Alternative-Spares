<!DOCTYPE html>
<html>
<head>
    <title>Baan ERP Item Checker</title>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
    <style>
        body {
            font-family: Arial;
            background: #f4f6f9;
            margin: 0;
            padding: 0;
        }

        .header {
            background: #1f2d3d;
            color: white;
            padding: 20px;
            font-size: 20px;
        }

        .container {
            padding: 30px;
        }

        input {
            padding: 10px;
            width: 300px;
            font-size: 14px;
        }

        .card {
            background: white;
            padding: 20px;
            margin-top: 20px;
            border-radius: 6px;
            box-shadow: 0px 2px 5px rgba(0,0,0,0.1);
        }

        .section-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .low-stock {
            color: red;
            font-weight: bold;
        }

        .stock-line {
            margin: 5px 0;
        }

        .no-data {
            color: gray;
        }

        @media(max-width:600px){
            input { width: 100%; }
        }
    </style>
</head>
<body>

<div class="header">
    Baan ERP Item Checker
</div>

<div class="container">

    <input type="text" id="itemCode" 
           placeholder="Enter Old or New Item Code"
           onkeyup="searchItem()">

    <div id="output"></div>

</div>

<script>

let mappingData = [];
let spareData = [];
let stockData = [];

Papa.parse("Ban Item_Code_Mapping (7).csv", {
    download: true,
    header: true,
    complete: function(results) {
        mappingData = results.data;
    }
});

Papa.parse("sparedata.csv", {
    download: true,
    header: true,
    complete: function(results) {
        spareData = results.data;
    }
});

Papa.parse("Spares stock.csv", {
    download: true,
    header: true,
    complete: function(results) {
        stockData = results.data;
    }
});

function getStockHTML(itemCode) {

    let stockVW = stockData.filter(row =>
        row["Item code"] === itemCode &&
        (row["Warehouse code"] === "ZBF12T" ||
         row["Warehouse code"] === "ZBF12S")
    );

    let html = "";
    let total = 0;

    if (stockVW.length > 0) {
        stockVW.forEach(row => {
            let qty = parseFloat(row["Stock on Hand"]) || 0;
            total += qty;

            let cls = qty < 5 ? "low-stock" : "";

            html += `<div class="stock-line ${cls}">
                        ${row["Warehouse code"]} : ${qty}
                     </div>`;
        });

        html += `<hr><strong>Total Stock: ${total}</strong>`;
    } else {
        html = `<div class="no-data">No Stock Available</div>`;
    }

    return html;
}

function searchItem() {

    let code = document.getElementById("itemCode").value.trim();
    let output = document.getElementById("output");

    if (code.length < 2) {
        output.innerHTML = "";
        return;
    }

    let mapping = mappingData.find(row => 
        row.Old_Item_Code === code ||
        row.New_item_code === code
    );

    if (!mapping) {
        output.innerHTML = `<div class="card">
            <div class="no-data">Item Not Found</div>
        </div>`;
        return;
    }

    let newCode = mapping.New_item_code;
    let description = mapping.New_Item_Desc;

    let spare = spareData.find(row => row.Item === newCode);

    let altCode = spare ? spare.AlternativeItem : null;
    let altDescription = spare ? spare["Desc..1"] : null;

    let altStockHTML = altCode ? getStockHTML(altCode) : "";

    output.innerHTML = `

        <div class="card">
            <div class="section-title">Main Item</div>
            <div><strong>New Code:</strong> ${newCode}</div>
            <div><strong>Description:</strong> ${description}</div>

            <div style="margin-top:15px;">
                <strong>Warehouse Stock</strong>
                ${getStockHTML(newCode)}
            </div>
        </div>

        <div class="card">
            <div class="section-title">Alternative Item</div>
            ${
                altCode ?
                `
                <div><strong>Alternative Code:</strong> ${altCode}</div>
                <div><strong>Description:</strong> ${altDescription}</div>
                <div style="margin-top:15px;">
                    <strong>Warehouse Stock</strong>
                    ${altStockHTML}
                </div>
                `
                :
                `<div class="no-data">No Alternative Available</div>`
            }
        </div>

    `;
}

</script>

</body>
</html>
